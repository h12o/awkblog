<!DOCTYPE html>
<html>
  <head>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.0/dist/browser-image-compression.js"></script>
    <script type="text/javascript" src="/assets/uploadImage.js"></script>
  </head>
  <body>
    <h1>Upload image file with S3 pre-signed URL</h1>
    <h2>Select Image</h2>
    <form id="form">
      <input name="file" type="file" accept="image/jpeg, image/png, image/gif">
      <button type="submit">submit</button>
    </form>
    <h2>log</h2>
    <textarea id="log" readonly style="width: 100%; height:20em;">
    </textarea>
    <h2>uploaded image</h2>
    <img id="image-space" style=" object-fit: contain; max-width: 50%; max-height: 50%;" src="/not-exist">

    <script>
      async function logSubmit(event) {
        event.preventDefault()

        try {
          imageSpace.src = await uploadImage(
            form.file.files[0],
            function (message) { log.textContent += message + "\n" }
          )
        } catch (e) {
          console.log(`catched ${e}`)
        }
      }

      const form = document.getElementById("form");
      const log = document.getElementById("log");
      const imageSpace = document.getElementById("image-space")
      form.addEventListener("submit", logSubmit);
    </script>
  </body>
</html>
